# Coolify deployment configuration
# Usage: Set compose files to "docker-compose.yml;docker-compose.coolify.yml" in Coolify
#
# Coolify Setup:
# 1. Coolify automatically creates a network for all services in this stack
# 2. When prompted for domains:
#    - MongoDB, MinIO, Backend, Admin/Student Frontends: SKIP or leave empty (internal only)
#    - Nginx: Configure your domain (e.g., yourdomain.com) - this is the ONLY public service
# 3. Configure environment variables in Coolify UI

name: silveredge-coolify

services:
  mongodb:
    volumes:
      - mongodb_data:/data/db
    restart: always

  minio:
    volumes:
      - minio_data:/data
    restart: always

  backend:
    build:
      context: .
      dockerfile: backend/Dockerfile
    restart: always
    environment:
      NODE_ENV: production

  admin-frontend:
    build:
      context: .
      dockerfile: apps/admin/Dockerfile
    restart: always

  student-frontend:
    build:
      context: .
      dockerfile: apps/student/Dockerfile
    restart: always

  nginx:
    volumes:
      - ./nginx/nginx.prod.conf:/etc/nginx/nginx.conf:ro
    restart: always
    ports:
      - "80"

volumes:
  mongodb_data:
  minio_data:
